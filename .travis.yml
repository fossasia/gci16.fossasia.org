language: ruby
cache: bundler
services: docker
rvm:
  - 2.3.3
install:
  - gem install danger
  - danger --verbose
  - bundle install
script:
  - bundle exec jekyll build
  - percy snapshot _site/
  - ruby ./scripts/ImgChecker/ImgChecker.rb
  - docker run --volume=$(pwd):/app --workdir=/app coala/base:pre /bin/bash -c
    "coala --apply-patches --no-orig;
    coala-ci || true"
  - git config --global user.email "travis@travis-ci.org"
  - git config --global user.name "Travis CI"
  - git checkout -b coala-fix
  - git add .
  - git commit --message "Coala auto-patch for Travis CI Build:$TRAVIS_BUILD_NUMBER | Generated by Travis CI"
  - git remote add orgin-pages https://coala-autofix-bot:$COALA_FIXER@github.com/fossasia/gci16.fossasia.org.git
  - git push --quiet --set-upstream orgin-pages coala-fix
branches:
  only:
    - gh-pages  # Must be appear explicitly
    - /./  # Allows builds for any other branch name
